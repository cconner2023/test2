<project_specification>
  <project_name>ADTMC (Advanced Diagnostic Triage and Medical Compliance)</project_name>

  <overview>
    A Progressive Web App (PWA) that expedites patient triage according to MEDCOM PAM regulations.
    The app provides clinical decision trees, medication references, training guidelines, and note
    capture with barcode generation — all accessible offline on any device with a native feel.
    Currently front-end only and stateless, but architected for future backend expansion
    (user accounts, clinic association, persistent offline sync).
  </overview>

  <technology_stack>
    <frontend>
      <framework>React 19 with TypeScript</framework>
      <bundler>Vite 7</bundler>
      <styling>Tailwind CSS 4</styling>
      <animations>motion, @formkit/auto-animate</animations>
      <icons>lucide-react</icons>
      <barcode>@zxing/library, qr-scanner, qrcode.react, pdf417-generator</barcode>
    </frontend>
    <backend>
      <runtime>none - stateless front-end application</runtime>
      <database>none - stateless application (architected for future backend)</database>
    </backend>
    <pwa>
      <plugin>vite-plugin-pwa with Workbox</plugin>
      <display>standalone</display>
      <orientation>portrait</orientation>
      <caching>Google Fonts (1yr), app shell, static assets</caching>
    </pwa>
    <deployment>
      <platform>GitHub Pages</platform>
      <base_url>/ADTMC/</base_url>
    </deployment>
  </technology_stack>

  <prerequisites>
    <environment_setup>
      Node.js (LTS), npm, Git. Run npm install then npm run dev.
    </environment_setup>
  </prerequisites>

  <feature_count>51</feature_count>

  <data_policy>
    CRITICAL: Data files in src/Data/ (Algorithms.ts, CatData.ts, MedData.ts, Release.ts)
    contain verbatim MEDCOM PAM content. These files MUST NOT be modified, refactored, or
    reformatted. They are maintained from outside sources. All refactoring, cleaning, and
    optimization work applies to components, hooks, utilities, types, and configuration only.
  </data_policy>

  <security_and_access_control>
    <user_roles>
      <role name="anonymous">
        <permissions>
          - Full access to all triage algorithms
          - Full access to medication reference
          - Full access to training guidelines
          - Can create and export notes via barcode
          - Can import notes via barcode scan
        </permissions>
      </role>
    </user_roles>
    <authentication>
      <method>none - future expansion</method>
      <session_timeout>none</session_timeout>
    </authentication>
    <future_expansion>
      Application architecture should support adding user authentication, role-based access
      (user hierarchy), and clinic-specific data isolation in future iterations.
    </future_expansion>
  </security_and_access_control>

  <core_features>
    <core_triage_flow>
      - Algorithm page renders all card types correctly (initial, choice, count, action, rf)
      - Red flag cards display warnings and allow selection
      - Choice cards present options and record selection
      - Count cards allow numeric scoring (e.g., Centor score)
      - Action cards display as non-selectable information
      - Disposition is correctly computed from answers (CAT I-IV, OTHER)
      - Decision-making guidance displays (DMP, MCP, LIM)
      - Ancillary findings display (labs, medications, referrals)
      - Algorithm state resets when switching symptoms
      - Card visibility updates based on prior answers
    </core_triage_flow>

    <category_and_symptom_navigation>
      - Main category list displays all 10 categories with icons and colors
      - Selecting a category shows its subcategory symptoms
      - Selecting a symptom navigates to the algorithm
      - Back navigation returns to previous view state
      - Desktop grid layout computes correctly
      - Mobile single-column layout renders correctly
      - View state transitions animate smoothly
    </category_and_symptom_navigation>

    <search>
      - Search index builds from all data sources on load
      - Search input debounces at 150ms
      - Results include categories, complaints, training, DDX, medications
      - Result type priority ordering is correct
      - Selecting a search result navigates to the correct view
    </search>

    <medications_reference>
      - Medications drawer opens and closes correctly
      - All medication fields display (indication, contra, MOI, dosing, adverse)
      - Pregnancy category flags display correctly
      - Aviation restriction flags display correctly
      - Medications referenced from algorithms link correctly
    </medications_reference>

    <note_capture_and_barcodes>
      - Note writing page captures disposition and content
      - Barcode (PDF417) generates from note data
      - QR code generates from note data
      - Note import via barcode scan works
      - Camera permissions handled gracefully
      - Note data encodes/decodes correctly round-trip
    </note_capture_and_barcodes>

    <pwa_and_offline>
      - Service worker registers and activates
      - App functions fully offline after initial load
      - Update notification appears when new version available
      - App installs as standalone PWA on all devices
    </pwa_and_offline>

    <ui_ux_and_responsiveness>
      - Dark/light theme toggle persists in localStorage
      - Theme respects system preference on first load
      - Responsive layout adapts at md breakpoint
      - Drawer components drag-to-expand/collapse on mobile
      - Safe area handling for mobile notches/bars
      - Animations are smooth and performant (60fps)
      - Touch targets meet minimum 44px for mobile
    </ui_ux_and_responsiveness>

    <training_and_guidelines>
      - MEDCOM training competencies display correctly
      - STP (Standard Task Protocol) data displays with nested options
      - General guidelines render per symptom
      - Differential diagnoses (DDX) display per symptom
    </training_and_guidelines>

    <settings>
      - Settings page accessible from side menu
      - Theme toggle functional in settings
      - App version displays correctly
    </settings>
  </core_features>

  <existing_architecture>
    <components>
      AlgorithmPage, QuestionCard, CategoryList, NavTop, SideMenu,
      MedicationsDrawer, SymptomInfoDrawer, WriteNotePage, NoteImport,
      Settings, Barcode, DecisionMaking, DecisionMakingItem,
      SearchResults, UpdateNotification
    </components>
    <hooks>
      useNavigation (centralized navigation state),
      useSearch (search index and filtering),
      useAlgorithm (algorithm card state and progression),
      useBarcodeScanner (QR/barcode scanning with permissions),
      useNoteCapture (note capture functionality),
      useNoteImport (importing notes),
      useServiceWorker (PWA service worker updates)
    </hooks>
    <types>
      AlgorithmTypes.ts (AlgorithmType, AlgorithmOptions, answerOptions, dispositionType, decisionMakingType),
      CatTypes.ts (catDataTypes, subCatDataTypes, SearchResultType),
      NavTopTypes.ts (navigation component props)
    </types>
    <utilities>
      ThemeContext.tsx (light/dark theme with system detection),
      ColorUtilities.ts (category color mapping),
      AnimationConfig.ts (animation configuration)
    </utilities>
  </existing_architecture>

  <ui_layout>
    <main_structure>
      Single-page app with state-driven navigation (no router).
      Top navigation bar with search, menu button, and dynamic title.
      Side menu drawer for settings and secondary navigation.
      Main content area transitions between: category list → subcategory list → algorithm page.
      Full-screen drawers for medications, symptom info, notes.
      Desktop: multi-column grid layout. Mobile: single-column with drawer interactions.
    </main_structure>
  </ui_layout>

  <design_system>
    <color_palette>
      Category-specific colors mapped via ColorUtilities.
      Theme-aware: light and dark mode palettes.
      Tailwind CSS 4 design tokens.
    </color_palette>
    <typography>
      System font stack via Tailwind defaults.
      Google Fonts loaded and cached via service worker.
    </typography>
    <interactions>
      Drawer drag-to-expand with velocity-based snapping.
      Auto-animate for list transitions.
      Motion library for page transitions.
    </interactions>
  </design_system>

  <refactoring_goals>
    <code_quality>
      - Clean component separation of concerns
      - Consistent TypeScript strict typing across all files
      - Remove any dead code or unused imports
      - Standardize naming conventions
      - Extract reusable patterns into shared utilities
    </code_quality>
    <performance>
      - Optimize React render cycles (memoization where beneficial)
      - Lazy load heavy components (barcode scanning, note pages)
      - Optimize search index build time
      - Ensure smooth 60fps animations on mobile
      - Minimize bundle size
    </performance>
    <maintainability>
      - Prepare hook interfaces for future backend data fetching
      - Abstract data access patterns for future API integration
      - Document component APIs and hook contracts
      - Ensure consistent error boundaries
    </maintainability>
    <native_feel>
      - Haptic-quality touch interactions
      - Platform-appropriate gestures (swipe, drag)
      - No visible web artifacts (rubber-banding, text selection on tap)
      - Smooth transitions matching native app conventions
    </native_feel>
  </refactoring_goals>

  <future_expansion_notes>
    The following are NOT in current scope but the architecture should accommodate:
    - User authentication and accounts
    - User roles with hierarchy
    - Clinic-specific data and settings
    - Backend API for persistent note storage (notes currently barcode-only)
    - Offline sync (currently offline-capable but no sync needed without backend)
    - Multi-user collaboration within clinics
  </future_expansion_notes>

  <implementation_steps>
    <step number="1">
      <title>Foundation Verification</title>
      <tasks>
        - Verify all existing features work correctly as baseline
        - Audit TypeScript strict mode compliance
        - Identify and remove dead code
      </tasks>
    </step>
    <step number="2">
      <title>Core Triage Flow Optimization</title>
      <tasks>
        - Refactor useAlgorithm hook for clarity and performance
        - Optimize AlgorithmPage and QuestionCard rendering
        - Ensure all card types render correctly
        - Verify disposition computation accuracy
      </tasks>
    </step>
    <step number="3">
      <title>Navigation and Search</title>
      <tasks>
        - Refactor useNavigation for cleaner state management
        - Optimize search index and filtering
        - Ensure smooth view transitions
        - Verify desktop grid and mobile layouts
      </tasks>
    </step>
    <step number="4">
      <title>UI/UX Polish and Native Feel</title>
      <tasks>
        - Optimize drawer interactions and animations
        - Ensure touch targets and safe areas
        - Verify dark/light theme consistency
        - Test responsive behavior across breakpoints
      </tasks>
    </step>
    <step number="5">
      <title>PWA, Offline, and Barcode Features</title>
      <tasks>
        - Verify service worker and offline functionality
        - Test barcode generation and scanning
        - Verify note capture round-trip
        - Test PWA install on multiple platforms
      </tasks>
    </step>
    <step number="6">
      <title>Performance and Final Polish</title>
      <tasks>
        - Bundle size optimization
        - Lazy loading implementation
        - Accessibility audit
        - Cross-device testing
      </tasks>
    </step>
  </implementation_steps>

  <success_criteria>
    <functionality>
      All 86 triage algorithms navigate correctly with proper dispositions.
      All 136 medications display complete information.
      Search returns accurate results across all data types.
      Note capture and barcode round-trip works reliably.
    </functionality>
    <user_experience>
      App feels native on iOS, Android, and desktop.
      Smooth 60fps animations and transitions.
      No visible web artifacts (rubber-banding, text selection, etc.).
      Intuitive navigation with no dead ends.
    </user_experience>
    <technical_quality>
      Clean, maintainable TypeScript with strict typing.
      No dead code or unused dependencies.
      Well-organized component and hook architecture.
      Ready for future backend integration without major refactoring.
    </technical_quality>
    <offline_and_pwa>
      Works fully offline on all devices after initial load.
      Installs as standalone PWA.
      Updates gracefully when new versions are available.
    </offline_and_pwa>
  </success_criteria>
</project_specification>
