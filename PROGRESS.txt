Refactor — Progress Log
## RESTRICTIONS --
# 1 do not edit data, overal functionality, or UI without explicit instructions to do so
# 2 Ensure code is readable, maintainable, and has no duplicates
# 3 review your changes upon completion, and clean up any dead or orphaned code. 

## ISSUES -- 
=================================================
## Problem #1 [COMPLETED] - BaseDrawer.tsx used TWO redundant systems for mobile/desktop responsiveness
=================================================
# Problem #2 [COMPLETED] -> main component grid
=================================================
# Problem #3 [COMPLETED] -> main menu (mobile) button and title
=================================================
# Problem #4 [COMPLETED] -> main menu appearance on mobile
=================================================
# Problem #5 [COMPLETED] -> useNoteRestore, useNoteCapture, useNoteImport deduplicate code
=================================================
# Problem #6 [COMPLETED] -> useColumnCarousel, useNavigation, and useSwipeNavigation with common code
=================================================
# Problem #7 [COMPLETED] -> Mobile Back button functionality
=================================================
# Problem #8 [COMPLETED] -> drawer configuration on mobile.
=================================================
# Problem #9 [COMPLETED] -> Saved notes (Settings -> My Notes) swipe animation and multi-select
=================================================
# Problem #10 [COMPLETED] -> Saved notes (Settings -> My Notes) swipe animation and multi-select: reduce horizontal swipe threshold. Review useSwipeNavigation for duplicate code. # Resolution: Reduced swipe threshold from 60px to 40px. 
=================================================
# Problem #11 [COMPLETED] -> Download notification (useInstallPrompts.ts). This functions on mobile, but fails to render on desktop. The text saying 'App cached successfully' may interfere. We may need to run a check for desktop browsers, we may need to change our SW / manifest / vite # Resolution: Root cause was a race condition
=================================================
# Problem #12 [COMPLETED] -> Duplicate Code. 
=================================================
# Problem #13 [COMPLETED] -> PWA functionality. related to #11 - installed PWAs do not render the shortcuts or icons.
=================================================
# Problem #14 [COMPLETED] -> App.tsx and NoteImport.tsx handle the navigation from an imported note to the settings -> my notes and selects the saved note.
=================================================
# Problem #15 [COMPLETED] -> mobile delete in settings double tap
=================================================
# Problem #16 [COMPLETED] -> edit note from settings -> my notes. edit removed. view note navigates to proper panel. 
=================================================
# Problem #17 [COMPLETED] -> desktop BaseDrawer triggers animation in ColumnA to revert to main. # Resolution: Drawer state changes caused unnecessary ColumnA re-renders, producing spring glitches. Fix: (1) wrapped ColumnA in React.memo, (2) stabilized callback props (handleNavigationClick deps, onSwipeBack inline arrow), (3) decoupled useColumnCarousel sync effect from callback identity via refs.
=================================================
# Problem #18 [COMPLETED] -> mobile drawer backdrop. All drawer backdrops are somewhat different. They should match on mobile. # Resolution: Changed BaseDrawer default backdropOpacity from 0.9 to 0.3 (matching MedicationsDrawer). Removed redundant explicit backdropOpacity props from all 5 drawers (Settings, NoteImport, MedicationsDrawer, SymptomInfoDrawer, WriteNotePage). Single source of truth now lives in BaseDrawer.
=================================================
# Problem #19 [COMPLETED] -> if a new version is 'installed', we should navigate to settings -> release notes after the reload. # Resolution: skipWaiting() sets localStorage flag 'postUpdateNav' before reload. App.tsx reads and clears flag on mount, opens Settings -> Release Notes. Added 'release-notes' to Settings initialPanel type.
=================================================
# Problem #20 [COMPLETED] -> WriteNotePage relied on previous animation changes to navigate the wizard cleanly. We've lost those changes and should implement the animation. # Resolution: Root cause was competing animation mechanisms — React's inline style `transform: translateX(...)` jumped the carousel immediately on re-render, before the useEffect could apply a CSS transition. Fix: (1) removed inline transform from carousel div, (2) replaced useEffect with useLayoutEffect that snaps on initial render (no flash) and animates on subsequent page changes, (3) swipe handlers remain unchanged as they manipulate the DOM directly.
=================================================
# Problem #21 [COMPLETED] -> Settings -> My Notes. Checkmark should only be visible if selected. We should look at our ColorUtilities.ts for styling and consistency. # Resolution: (1) Checkbox icon now only renders when the note is selected (removed always-visible empty Square). Applied to both SwipeableNoteItem (mobile) and NoteItemSettings (desktop). (2) Added `dispositionBadge` property to ColorUtilities.ts for all 6 cases. Both mobile and desktop note items now use the centralized theme colors instead of the local `getDispositionColor` function (which used generic Tailwind colors). Removed `getDispositionColor` and unused `Square` import.
=================================================
# Problem #22 [COMPLETED] -> Settings -> My Notes -> View saved note. text generates a new timestamp regardless of the timestamp in the saved note. Time stamp is immutable unless there are changes to the note structure or HPI. # Resolution: Threaded the saved note's timestamp through the full restore → view chain: (1) NoteRestoreResult now returns `parsed.timestamp`, (2) WriteNoteData carries optional `timestamp`, (3) useNoteCapture.generateNote accepts and forwards `timestamp` to assembleNote, (4) WriteNotePage tracks `noteTimestamp` state — initialized from saved note, cleared to null on first content option change (includeAlgorithm, includeDecisionMaking, includeHPI, or note text). When null, assembleNote defaults to new Date().
=================================================
# Problem #23 [COMPLETED] -> BaseDrawer on desktop has no animation, and it results in clunky appearance. On desktop we should utilize the scale and orient the scale-from direction to top-left | top-right depending on position of the drawer component. # Resolution: Changed desktop panel animation from barely-visible `scale(0.97) + translateY(8px)` with `transformOrigin: center bottom` to a more pronounced `scale(0.95)` with directional `transformOrigin` based on `desktopPosition` — `top left` for left-aligned drawers (MedicationsDrawer), `top right` for right-aligned drawers (Settings, WriteNotePage, NoteImport). Panels now scale in/out from their respective corners.
- fix resulted in loss of animation to WriteNotePage. # Sub-fix: Replaced carousel-based wizard animation (useLayoutEffect + translateX + direct DOM manipulation) with Settings-style slide transitions using CSS keyframe animations (animate-slide-in-left / animate-slide-in-right). Removed carouselRef, contentRef, isInitialRenderRef; added slideDirection state and SlideWrapper component. Pages now conditionally render (only active page in DOM) instead of all 4 in a flex row. Mobile swipe simplified to direction detection with 40px threshold.
=================================================
# Problem #24 [PENDING] -> Clicking search on mobile and then canceling re-renders the AlgorithmPage. This could be problematic if a user wants to exit search and continue their note. State should be maintained in this case